<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redis新数据类型 | 乔木先生</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="Java后端技术博客,专注Java后端学习与总结。Java,Spring,SpringBoot,SpringMVC,SpringCloud,Mybatis,Linux,css3,html5,Maven,git,github等技术文章。">
    <meta name="keywords" content="Java后端技术博客,专注Java后端学习与总结。Java,Spring,SpringBoot,SpringMVC,SpringCloud,Mybatis,Linux,css3,html5,Maven,git,github等技术文章。">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.a29a3543.css" as="style"><link rel="preload" href="/assets/js/app.ce0d757e.js" as="script"><link rel="preload" href="/assets/js/2.06b51e28.js" as="script"><link rel="preload" href="/assets/js/13.7c680a8f.js" as="script"><link rel="prefetch" href="/assets/js/10.25ab3c87.js"><link rel="prefetch" href="/assets/js/11.0710d907.js"><link rel="prefetch" href="/assets/js/12.b69f61e1.js"><link rel="prefetch" href="/assets/js/14.c2a530ec.js"><link rel="prefetch" href="/assets/js/15.0344ac89.js"><link rel="prefetch" href="/assets/js/16.8ba3e333.js"><link rel="prefetch" href="/assets/js/17.d5aa2799.js"><link rel="prefetch" href="/assets/js/18.220bdb83.js"><link rel="prefetch" href="/assets/js/19.67fc625a.js"><link rel="prefetch" href="/assets/js/20.8a296438.js"><link rel="prefetch" href="/assets/js/21.bebe2d14.js"><link rel="prefetch" href="/assets/js/22.a2f38cf1.js"><link rel="prefetch" href="/assets/js/23.584f4a98.js"><link rel="prefetch" href="/assets/js/24.b4f54e0d.js"><link rel="prefetch" href="/assets/js/25.4e296918.js"><link rel="prefetch" href="/assets/js/26.e9f8a341.js"><link rel="prefetch" href="/assets/js/27.d1e12903.js"><link rel="prefetch" href="/assets/js/28.aad73944.js"><link rel="prefetch" href="/assets/js/29.1f69ecb2.js"><link rel="prefetch" href="/assets/js/3.04a7b8c9.js"><link rel="prefetch" href="/assets/js/30.31228ad4.js"><link rel="prefetch" href="/assets/js/31.876161e0.js"><link rel="prefetch" href="/assets/js/32.00970883.js"><link rel="prefetch" href="/assets/js/33.d6286171.js"><link rel="prefetch" href="/assets/js/34.6f7f8dea.js"><link rel="prefetch" href="/assets/js/35.61b61fb3.js"><link rel="prefetch" href="/assets/js/36.ff818b3d.js"><link rel="prefetch" href="/assets/js/37.3b4a7cce.js"><link rel="prefetch" href="/assets/js/38.c3e4cbf3.js"><link rel="prefetch" href="/assets/js/4.23b49261.js"><link rel="prefetch" href="/assets/js/5.cf7ce6d9.js"><link rel="prefetch" href="/assets/js/6.de48cd74.js"><link rel="prefetch" href="/assets/js/7.5fd9e1bc.js"><link rel="prefetch" href="/assets/js/8.31885ab6.js"><link rel="prefetch" href="/assets/js/9.88734d8e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a29a3543.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="乔木先生" class="logo"> <span class="site-name can-hide">乔木先生</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/kas755c4/" class="nav-link">JavaSE</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java框架" class="dropdown-title"><!----> <span class="title" style="display:;">Java框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/24j4ehty/" class="nav-link">SpringCloud</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><!----> <span class="title" style="display:;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>NoSQL</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/bp3ikv4g/" class="nav-link">Redis</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><!----> <span class="title" style="display:;">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>消息中间件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/vd45cpcf/" class="nav-link">RabbitMQ</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><!----> <span class="title" style="display:;">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/e938xib2/" class="nav-link">Linux</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><!----> <span class="title" style="display:;">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/eb9ks77i/" class="nav-link">Git</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/qaomuu" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><!----> <span class="title" style="display:;">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/kas755c4/" class="nav-link">JavaSE</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java框架" class="dropdown-title"><!----> <span class="title" style="display:;">Java框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/24j4ehty/" class="nav-link">SpringCloud</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><!----> <span class="title" style="display:;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>NoSQL</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/bp3ikv4g/" class="nav-link">Redis</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><!----> <span class="title" style="display:;">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>消息中间件</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/vd45cpcf/" class="nav-link">RabbitMQ</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><!----> <span class="title" style="display:;">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/e938xib2/" class="nav-link">Linux</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><!----> <span class="title" style="display:;">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/eb9ks77i/" class="nav-link">Git</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/qaomuu" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Redis</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/bp3ikv4g/" class="sidebar-link">Redis概述&amp;安装</a></li><li><a href="/pages/0oaka83c/" class="sidebar-link">Redis常用命令&amp;数据类型</a></li><li><a href="/pages/57aemd8k/" class="sidebar-link">Redis配置文件</a></li><li><a href="/pages/3a16c7g6/" class="sidebar-link">Redis发布和订阅</a></li><li><a href="/pages/wuy0993s/" aria-current="page" class="active sidebar-link">Redis新数据类型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/wuy0993s/#bitmaps" class="sidebar-link">Bitmaps</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/wuy0993s/#命令" class="sidebar-link">命令</a></li><li class="sidebar-sub-header level4"><a href="/pages/wuy0993s/#setbit" class="sidebar-link">setbit</a></li><li class="sidebar-sub-header level4"><a href="/pages/wuy0993s/#getbit" class="sidebar-link">getbit</a></li><li class="sidebar-sub-header level4"><a href="/pages/wuy0993s/#bitcount" class="sidebar-link">bitcount</a></li><li class="sidebar-sub-header level4"><a href="/pages/wuy0993s/#bitop" class="sidebar-link">bitop</a></li><li class="sidebar-sub-header level3"><a href="/pages/wuy0993s/#bitmaps与set对比" class="sidebar-link">Bitmaps与set对比</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/wuy0993s/#hyperloglog" class="sidebar-link">HyperLogLog</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/wuy0993s/#命令-2" class="sidebar-link">命令</a></li><li class="sidebar-sub-header level4"><a href="/pages/wuy0993s/#pfadd" class="sidebar-link">pfadd</a></li><li class="sidebar-sub-header level4"><a href="/pages/wuy0993s/#pfcount" class="sidebar-link">pfcount</a></li><li class="sidebar-sub-header level4"><a href="/pages/wuy0993s/#pfmerge" class="sidebar-link">pfmerge</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/wuy0993s/#geospatial" class="sidebar-link">Geospatial</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/wuy0993s/#命令-3" class="sidebar-link">命令</a></li><li class="sidebar-sub-header level4"><a href="/pages/wuy0993s/#geoadd" class="sidebar-link">geoadd</a></li><li class="sidebar-sub-header level4"><a href="/pages/wuy0993s/#geopos" class="sidebar-link">geopos</a></li><li class="sidebar-sub-header level4"><a href="/pages/wuy0993s/#geodist" class="sidebar-link">geodist</a></li><li class="sidebar-sub-header level4"><a href="/pages/wuy0993s/#georadius" class="sidebar-link">georadius</a></li></ul></li></ul></li><li><a href="/pages/a7v81744/" class="sidebar-link">Redis Java客户端Jedis</a></li><li><a href="/pages/jsf92i5m/" class="sidebar-link">SpringBoot整合Redis</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=%E6%95%B0%E6%8D%AE%E5%BA%93" title="分类" data-v-06225672>数据库</a></li><li data-v-06225672><a href="/categories/?category=Redis" title="分类" data-v-06225672>Redis</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="javascript:;" data-v-06225672>乔木先生</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-12-12</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">Redis新数据类型<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="bitmaps"><a href="#bitmaps" class="header-anchor">#</a> Bitmaps</h2> <p>现代计算机用二进制（位） 作为信息的基础单位， 1个字节等于8位， 例如“abc”字符串是由3个字节组成， 但实际在计算机存储时将其用二进制表示， “abc”分别对应的ASCII码分别是97、 98、 99， 对应的二进制分别是01100001、 01100010和01100011，如下图</p> <p><img src="https://file.qaomuu.com/blog/-Eqy_qbZm8xAZIJdKVg6ei_mmouTZvTf5MqvjKFuZ68.png" alt="image"></p> <p>合理地使用操作位能够有效地提高内存使用率和开发效率。</p> <div class="language- extra-class"><pre><code>Redis提供了Bitmaps这个“数据类型”可以实现对位的操作：
</code></pre></div><ol><li>Bitmaps本身不是一种数据类型， 实际上它就是字符串（key-value） ， 但是它可以对字符串的位进行操作。</li> <li>Bitmaps单独提供了一套命令， 所以在Redis中使用Bitmaps和使用字符串的方法不太相同。 可以把Bitmaps想象成一个以'位'为单位的数组， 数组的每个单元只能存储0和1， 数组的下标在Bitmaps中叫做偏移量。</li></ol> <p><img src="https://file.qaomuu.com/blog/8JtVqSbBk6kgx_T93ZMKLYEG6Ijuk4HtjMw7okcr-LI.png" alt="image"></p> <h3 id="命令"><a href="#命令" class="header-anchor">#</a> 命令</h3> <h4 id="setbit"><a href="#setbit" class="header-anchor">#</a> setbit</h4> <ul><li><code>setbit &lt;key&gt; &lt;offset&gt; &lt;value&gt;</code> ：设置Bitmaps中某个偏移量的值（0或1）
<ul><li>offset：偏移量从0开始</li></ul></li></ul> <p>实例：每个独立用户是否访问过网站存放在Bitmaps中， 将访问的用户记做1， 没有访问的用户记做0， 用偏移量作为用户的id。</p> <p>设置键的第offset个位的值（从0算起），假设现在有20个用户，userid=1、6、11、15、19 的用户对网站进行了访问， 那么当前Bitmaps初始化结果如图：</p> <p><img src="https://file.qaomuu.com/blog/sPfDK-4tG3D3VFPgDhZqtrK_xMhfuRrSB4_MUx558lU.png" alt="image"></p> <p><img src="https://file.qaomuu.com/blog/X_oFxs-uhdlEhw4h5KktcKE222TlnwzoZFNKWOrD1rk.png" alt="image"></p> <p>很多应用的用户id以一个指定数字（例如10000） 开头， 直接将用户id和Bitmaps的偏移量对应势必会造成一定的浪费， 通常的做法是每次做setbit操作时将用户id减去这个指定数字。</p> <blockquote><p>在第一次初始化Bitmaps时，假如偏移量非常大，整个初始化过程执行会比较慢，可能会造成Redis的阻塞。</p></blockquote> <h4 id="getbit"><a href="#getbit" class="header-anchor">#</a> getbit</h4> <ul><li><code>getbit &lt;key&gt; &lt;offset&gt;</code> ：获取Bitmaps中某个偏移量的值，获取键的第offset位的值（从0开始算）</li></ul> <p>实例：获取id=8的用户是否访问过， 返回0说明没有访问过：</p> <p><img src="https://file.qaomuu.com/blog/qJnKYraAUUNS7LhU-_zUSJzAzwm04NJ4WmaEeKzN3xk.png" alt="image"></p> <p>因为100根本不存在，所以也是返回0</p> <h4 id="bitcount"><a href="#bitcount" class="header-anchor">#</a> bitcount</h4> <p>统计<strong>字符串</strong>被设置为1的bit数。一般情况下，给定的整个字符串都会被进行计数，通过指定额外的 start 或 end 参数，可以让计数只在特定的位上进行。</p> <p>start 和 end 参数的设置，都可以使用负数值：比如 -1 表示最后一个位，而 -2 表示倒数第二个位，start、end 是指bit组的字节的下标数，二者皆包含。</p> <ul><li><code>bitcount &lt;key&gt; [start end]</code> ：统计字符串从start字节到end字节比特值为1的数量</li></ul> <p>实例：计算访问的用户数量</p> <p><img src="https://file.qaomuu.com/blog/CQcQfgWRU8mAIcvf_vEdZRJdErKsTzpK9ambgnEBam4.png" alt="image"></p> <p>start和end代表起始和结束字节数，下面操作计算用户id在第1个字节到第3个字节之间的独立访问用户数， 对应的用户id是11，15， 19。</p> <p><img src="https://file.qaomuu.com/blog/BeWLtbXx7ZyIxCS5SUOQnIFBumpZgLXZ1b3yKUDOKAM.png" alt="image"></p> <p>举例： K1 【01000001  01000000  00000000  00100001】，对应【0，1，2，3】</p> <ul><li><code>bitcount K1 1 2</code> ： 统计下标1、2字节组中bit=1的个数，即01000000  00000000
<ul><li><code>bitcount K1 1 2</code> → 1</li></ul></li> <li><code>bitcount K1 1 3</code> ： 统计下标1、3字节组中bit=1的个数，即01000000  00000000  00100001
<ul><li><code>bitcount K1 1 3</code> → 3</li></ul></li> <li><code>bitcount K1 0 -2</code>  ：统计下标0到下标倒数第2，字节组中bit=1的个数，即01000001  01000000   00000000
<ul><li><code>bitcount K1 0 -2</code> → 3</li></ul></li></ul> <blockquote><p>redis的setbit设置或清除的是bit位置，而bitcount计算的是byte位置</p></blockquote> <h4 id="bitop"><a href="#bitop" class="header-anchor">#</a> bitop</h4> <ul><li><code>bitop and(or/not/xor) &lt;destkey&gt; [key…]</code> ：bitop是一个复合操作，它可以做多个Bitmaps的and（交集）、or（并集）、not（非）、xor（异或）操作并将结果保存在destkey中。</li></ul> <p>实例：</p> <p>11-04访问网站的userid=1,2,5,9。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>setbit user:1104 <span class="token number">1</span> <span class="token number">1</span>
setbit user:1104 <span class="token number">2</span> <span class="token number">1</span>
setbit user:1104 <span class="token number">5</span> <span class="token number">1</span>
setbit user:1104 <span class="token number">9</span> <span class="token number">1</span>
</code></pre></div><p><img src="https://file.qaomuu.com/blog/Uey4bSO_rYZZH9nT_hftQzEPkTJE7BFbGmO3oN6HQGA.png" alt="image"></p> <p>11-03访问网站的userid=0,1,4,9。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>setbit user:1103 <span class="token number">0</span> <span class="token number">1</span>
setbit user:1103 <span class="token number">1</span> <span class="token number">1</span>
setbit user:1103 <span class="token number">4</span> <span class="token number">1</span>
setbit user:1103 <span class="token number">9</span> <span class="token number">1</span>
</code></pre></div><p><img src="https://file.qaomuu.com/blog/632qOPNvpTBuZ0L5Wc7n6oLK2OK7Apn4PoXjwYRmp78.png" alt="image"></p> <p>计算出两天都访问过网站的用户数量：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>bitop and user:and:1104_03 user:1103 user:1104
</code></pre></div><p><img src="https://file.qaomuu.com/blog/Tz-5_oLzvniPEbdCXKjt-OF7bqMEE0WqM_wecIpjvHo.png" alt="image"></p> <p><img src="https://file.qaomuu.com/blog/GX3srnc3pMGL07dnG1VhkkYE88y3S0lP-oputbaYRsg.png" alt="image"></p> <p>计算出任意一天都访问过网站的用户数量（例如月活跃就是类似这种），可以使用or求并集：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>bitop or user:or:1104_03 user:1103 user:1104
</code></pre></div><p><img src="https://file.qaomuu.com/blog/jbS0nkay5HehI6Ne2V4oSVdvljEjl51vIF6BmzfdHYc.png" alt="image"></p> <h3 id="bitmaps与set对比"><a href="#bitmaps与set对比" class="header-anchor">#</a> Bitmaps与set对比</h3> <p>假设网站有1亿用户，每天独立访问的用户有5千万，如果每天用集合类型和Bitmaps分别存储活跃用户可以得到表：</p> <table><thead><tr><th>数据类型</th> <th>每个用户id占用空间</th> <th>需要存储的用户量</th> <th>全部内存量</th></tr></thead> <tbody><tr><td>集合类型</td> <td>64位</td> <td>50000000</td> <td>64位*50000000 = 400MB</td></tr> <tr><td>Bitmaps</td> <td>1位</td> <td>100000000</td> <td>1位*100000000 = 12.5MB</td></tr></tbody></table> <p>很明显，这种情况下使用Bitmaps能节省很多的内存空间，尤其是随着时间推移节省的内存还是非常可观的：</p> <table><thead><tr><th>数据类型</th> <th>一天</th> <th>一个月</th> <th>一年</th></tr></thead> <tbody><tr><td>集合类型</td> <td>400MB</td> <td>12GB</td> <td>144GB</td></tr> <tr><td>Bitmaps</td> <td>12.5MB</td> <td>375MB</td> <td>4.5GB</td></tr></tbody></table> <p>但Bitmaps并不是万金油，假如该网站每天的独立访问用户很少，例如只有10万（大量的僵尸用户），那么两者的对比如下表所示， 很显然，使用Bitmaps就不太合适了，因为基本上大部分位都是0。</p> <table><thead><tr><th>数据类型</th> <th>每个userid占用空间</th> <th>需要存储的用户量</th> <th>全部内存量</th></tr></thead> <tbody><tr><td>集合类型</td> <td>64位</td> <td>100000</td> <td>64位*100000 = 800KB</td></tr> <tr><td>Bitmaps</td> <td>1位</td> <td>100000000</td> <td>1位*100000000 = 12.5MB</td></tr></tbody></table> <h2 id="hyperloglog"><a href="#hyperloglog" class="header-anchor">#</a> HyperLogLog</h2> <p>在工作当中，经常会遇到与统计相关的功能需求，比如统计网站PV（PageView页面访问量），可以使用Redis的incr、incrby轻松实现。</p> <p>但像UV（UniqueVisitor，独立访客）、独立IP数、搜索记录数等需要去重和计数的问题如何解决？这种求集合中不重复元素个数的问题称为基数问题。</p> <p>解决基数问题有很多种方案：</p> <ol><li>数据存储在MySQL表中，使用distinct count计算不重复个数</li> <li>使用Redis提供的hash、set、bitmaps等数据结构来处理</li></ol> <p>以上的方案结果精确，但随着数据不断增加，导致占用空间越来越大，对于非常大的数据集是不切实际的。</p> <p>能否能够降低一定的精度来平衡存储空间？Redis推出了HyperLogLog。</p> <p>Redis HyperLogLog 是用来做基数统计的算法，HyperLogLog 的优点是，在输入元素的数量或者体积非常非常大时，计算基数所需的空间总是固定的、并且是很小的。</p> <p>在 Redis 里面，每个 HyperLogLog 键只需要花费 12 KB 内存，就可以计算接近 2^64 个不同元素的基数。这和计算基数时，元素越多耗费内存就越多的集合形成鲜明对比。</p> <p>但是，因为 HyperLogLog 只会根据输入元素来计算基数，而不会储存输入元素本身，所以 HyperLogLog 不能像集合那样，返回输入的各个元素。</p> <p></p> <blockquote><p>什么是基数?</p></blockquote> <blockquote><p>比如数据集 {1, 3, 5, 7, 5, 7, 8} 那么这个数据集的基数集为 {1, 3, 5 ,7, 8}，基数(不重复元素)为5。 基数估计就是在误差可接受的范围内，快速计算基数。</p></blockquote> <h3 id="命令-2"><a href="#命令-2" class="header-anchor">#</a> 命令</h3> <h4 id="pfadd"><a href="#pfadd" class="header-anchor">#</a> pfadd</h4> <ul><li><code>pfadd &lt;key&gt; &lt;element&gt; [element ...]</code> ：添加指定元素到 HyperLogLog 中</li></ul> <p>实例：将所有元素添加到指定HyperLogLog数据结构中。如果执行命令后HLL估计的近似基数发生变化，则返回1，否则返回0。</p> <p><img src="https://file.qaomuu.com/blog/Z2cCI6cG4HwlRbVX963QOcvQpv5gWjPW3D6QCS0E6x4.png" alt="image"></p> <h4 id="pfcount"><a href="#pfcount" class="header-anchor">#</a> pfcount</h4> <ul><li><code>pfcount&lt;key&gt; [key ...]</code> ：计算HLL的近似基数，可以计算多个HLL，比如用HLL存储每天的UV，计算一周的UV可以使用7天的UV合并计算即可。</li></ul> <p>实例：</p> <p><img src="https://file.qaomuu.com/blog/lpsjjH5Yv6udNsOer7GrKo6nWPC-6PLga-81j3KJmvE.png" alt="image"></p> <h4 id="pfmerge"><a href="#pfmerge" class="header-anchor">#</a> pfmerge</h4> <ul><li><code>pfmerge &lt;destkey&gt; &lt;sourcekey&gt; [sourcekey ...]</code> ：将一个或多个HLL合并后的结果存储在另一个HLL中，比如每月活跃用户可以使用每天的活跃用户来合并计算可得</li></ul> <p>实例：</p> <p><img src="https://file.qaomuu.com/blog/Ej8nrfbH0DCPZRAp2R7KB2BqNQ93aoPvPJ0uQq-2SR8.png" alt="image"></p> <h2 id="geospatial"><a href="#geospatial" class="header-anchor">#</a> Geospatial</h2> <p>Redis 3.2中增加了对GEO类型的支持。GEO，Geographic，地理信息的缩写。该类型，就是元素的2维坐标，在地图上就是经纬度。redis基于该类型，提供了经纬度设置，查询，范围查询，距离查询，经纬度Hash等常见操作。</p> <h3 id="命令-3"><a href="#命令-3" class="header-anchor">#</a> 命令</h3> <h4 id="geoadd"><a href="#geoadd" class="header-anchor">#</a> geoadd</h4> <ul><li><code>geoadd &lt;key&gt; &lt;longitude&gt; &lt;latitude&gt; &lt;member&gt; [longitude latitude member...]</code> ： 添加地理位置（经度，纬度，名称）</li></ul> <p>两极无法直接添加，一般会下载城市数据，直接通过 Java 程序一次性导入。</p> <p>有效的经度从 -180 度到 180 度。有效的纬度从 -85.05112878 度到 85.05112878 度。</p> <p>当坐标位置超出指定范围时，该命令将会返回一个错误。</p> <p>已经添加的数据，是无法再次往里面添加的。</p> <p>实例：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>geoadd china:city <span class="token number">121.47</span> <span class="token number">31.23</span> shanghai
geoadd china:city <span class="token number">106.50</span> <span class="token number">29.53</span> chongqing <span class="token number">114.05</span> <span class="token number">22.52</span> shenzhen <span class="token number">116.38</span> <span class="token number">39.90</span> beijing
</code></pre></div><p><img src="https://file.qaomuu.com/blog/kjXxInfxDQUMUtl8G7vjqAsSPsgsxWK4wlhdt1HCNQQ.png" alt="image"></p> <h4 id="geopos"><a href="#geopos" class="header-anchor">#</a> geopos</h4> <ul><li><code>geopos &lt;key&gt; &lt;member&gt; [member...]</code> ：获得指定地区的坐标值</li></ul> <p>实例：</p> <p><img src="https://file.qaomuu.com/blog/i4B0tjuXsYBAGtuxpgfcf9FhtsZo_neIUReIkGlEAaw.png" alt="image"></p> <h4 id="geodist"><a href="#geodist" class="header-anchor">#</a> geodist</h4> <ul><li><code>geodist &lt;key&gt; &lt;member1&gt; &lt;member2&gt; [m|km|ft|mi ]</code> ：获取两个位置之间的直线距离</li></ul> <p>单位：</p> <ul><li>m 表示单位为米[默认值]。</li> <li>km 表示单位为千米。</li> <li>mi 表示单位为英里。</li> <li>ft 表示单位为英尺。</li></ul> <p>如果用户没有显式地指定单位参数， 那么 GEODIST 默认使用米作为单位</p> <p>实例：</p> <p><img src="https://file.qaomuu.com/blog/HJ5WbVQGhtbO4goq--mUeXmyXjALzxra-XoGd1NIVB8.png" alt="image"></p> <h4 id="georadius"><a href="#georadius" class="header-anchor">#</a> georadius</h4> <ul><li><code>georadius &lt;key&gt; &lt; longitude&gt; &lt;latitude&gt; radius m|km|ft|mi</code> ：以给定的经纬度为中心，找出某一半径内的元素
<ul><li>经度 纬度 距离 单位</li></ul></li></ul> <p>实例：</p> <p><img src="https://file.qaomuu.com/blog/UdwHpXeFHciE-QfBF7PQueeFcGdUVM7Fzz31LC1Mrr4.png" alt="image"></p></div></div> <!----> <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=Redis" title="标签">#Redis</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/11/30, 16:24:57</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/3a16c7g6/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Redis发布和订阅</div></a> <a href="/pages/a7v81744/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Redis Java客户端Jedis</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/3a16c7g6/" class="prev">Redis发布和订阅</a></span> <span class="next"><a href="/pages/a7v81744/">Redis Java客户端Jedis</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/jsf92i5m/"><div>
            SpringBoot整合Redis
            <!----></div></a> <span class="date">12-21</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/a7v81744/"><div>
            Redis Java客户端Jedis
            <!----></div></a> <span class="date">12-20</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/lp31htbk/"><div>
            MacOS安装Git
            <!----></div></a> <span class="date">12-19</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2022
    <span>| <a href="https://beian.miit.gov.cn/#/Integrated/index" target="_blank">浙ICP备2022027766号-1</a><br><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33011002016801" target="_blank">浙公网安备 33011002016801号</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ce0d757e.js" defer></script><script src="/assets/js/2.06b51e28.js" defer></script><script src="/assets/js/13.7c680a8f.js" defer></script>
  </body>
</html>
